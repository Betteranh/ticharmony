<!-- src/main/resources/templates/layouts/main.html -->
<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <title layout:title-pattern="$CONTENT_TITLE – Tic Harmony">Tic Harmony</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
          rel="stylesheet">
    <style>
        .glass-navbar {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 2px 16px rgba(44, 62, 80, 0.04);
        }

        #drawerNotif {
            transition: transform 0.3s cubic-bezier(.4, 0, .2, 1);
        }

        #drawerOverlay {
            transition: opacity 0.2s;
            opacity: 0;
        }

        #drawerOverlay.opacity-100 {
            opacity: 1;
        }
    </style>
    <th:block layout:fragment="css"></th:block>
</head>
<body class="flex flex-col min-h-screen bg-blue-50">

<!-- Header -->
<div th:replace="fragments/header :: header"></div>

<!-- Main content -->
<main class="flex-grow min-h-screen pt-16">
    <div th:if="${module == 'home'}" layout:fragment="content"></div>
    <div th:if="${module != 'home'}" class="max-w-7xl mx-auto w-full px-4" layout:fragment="content"></div>
</main>

<!-- Footer -->
<div th:replace="fragments/footer :: footer"></div>

<!-- Drawer Notifications (Sidebar à droite, UNIQUEMENT pour un utilisateur connecté) -->
<div sec:authorize="isAuthenticated()">
    <!-- Overlay -->
    <div id="drawerOverlay"
         class="fixed inset-0 bg-black bg-opacity-30 z-50 hidden transition-opacity duration-200"></div>
    <!-- Drawer panel -->
    <div id="drawerNotif"
         class="fixed top-0 right-0 h-full w-80 max-w-full bg-white shadow-2xl z-50 transform translate-x-full transition-transform duration-300"
         style="will-change: transform;">
        <button id="closeDrawerNotif"
                class="absolute top-4 right-4 text-2xl text-gray-400 hover:text-gray-700">&times;</button>
        <div class="mt-8"></div>
        <div th:replace="fragments/notifications :: notifications"></div>
    </div>
    <!-- Script pour Drawer -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        document.addEventListener('DOMContentLoaded', function () {
            const notifToggle = document.getElementById('notifToggle');
            const drawer = document.getElementById('drawerNotif');
            const overlay = document.getElementById('drawerOverlay');
            const closeBtn = document.getElementById('closeDrawerNotif');
            // Ouvrir drawer
            notifToggle?.addEventListener('click', function(e) {
                drawer.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => { overlay.classList.add('opacity-100'); }, 10);
                e.stopPropagation();
            });
            // Fermer drawer
            function closeDrawer() {
                drawer.classList.add('translate-x-full');
                overlay.classList.add('hidden');
                overlay.classList.remove('opacity-100');
            }
            closeBtn?.addEventListener('click', closeDrawer);
            overlay?.addEventListener('click', closeDrawer);
            document.addEventListener('keydown', function(e) {
                if (e.key === "Escape") closeDrawer();
            });
        });
        /*]]>*/
    </script>
</div>
<!-- /Drawer Notifications -->

<!-- Shadow on navbar on scroll -->
<script>
    document.addEventListener('scroll', function () {
        const nav = document.querySelector('.glass-navbar');
        if (window.scrollY > 10) {
            nav.classList.add('shadow-lg');
        } else {
            nav.classList.remove('shadow-lg');
        }
    });
</script>

<th:block layout:fragment="scripts"></th:block>
</body>
</html>
